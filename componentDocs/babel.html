<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>babel | Webpack</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/webpack/assets/css/0.styles.9c1b922f.css" as="style"><link rel="preload" href="/webpack/assets/js/app.393cc6fe.js" as="script"><link rel="preload" href="/webpack/assets/js/2.aef1e260.js" as="script"><link rel="preload" href="/webpack/assets/js/20.e6f9b446.js" as="script"><link rel="prefetch" href="/webpack/assets/js/10.e06714a2.js"><link rel="prefetch" href="/webpack/assets/js/11.4e12cf72.js"><link rel="prefetch" href="/webpack/assets/js/12.a9a15216.js"><link rel="prefetch" href="/webpack/assets/js/13.1d4676b7.js"><link rel="prefetch" href="/webpack/assets/js/14.12a178b4.js"><link rel="prefetch" href="/webpack/assets/js/15.640f79dc.js"><link rel="prefetch" href="/webpack/assets/js/16.bf777738.js"><link rel="prefetch" href="/webpack/assets/js/17.2b318076.js"><link rel="prefetch" href="/webpack/assets/js/18.227e409a.js"><link rel="prefetch" href="/webpack/assets/js/19.54824584.js"><link rel="prefetch" href="/webpack/assets/js/21.cdfd52e2.js"><link rel="prefetch" href="/webpack/assets/js/22.b6820196.js"><link rel="prefetch" href="/webpack/assets/js/23.57c5b42e.js"><link rel="prefetch" href="/webpack/assets/js/24.fe003d37.js"><link rel="prefetch" href="/webpack/assets/js/25.0f75af45.js"><link rel="prefetch" href="/webpack/assets/js/26.e2b1e083.js"><link rel="prefetch" href="/webpack/assets/js/27.737f768f.js"><link rel="prefetch" href="/webpack/assets/js/28.2c259f08.js"><link rel="prefetch" href="/webpack/assets/js/29.e10e6ad9.js"><link rel="prefetch" href="/webpack/assets/js/3.6c3a2087.js"><link rel="prefetch" href="/webpack/assets/js/30.ad782dc1.js"><link rel="prefetch" href="/webpack/assets/js/31.de59d134.js"><link rel="prefetch" href="/webpack/assets/js/32.d27adfcc.js"><link rel="prefetch" href="/webpack/assets/js/33.2f2eee9c.js"><link rel="prefetch" href="/webpack/assets/js/34.fce7bfd4.js"><link rel="prefetch" href="/webpack/assets/js/35.43018eba.js"><link rel="prefetch" href="/webpack/assets/js/36.470e5de6.js"><link rel="prefetch" href="/webpack/assets/js/37.c1042c1f.js"><link rel="prefetch" href="/webpack/assets/js/38.0a6a0e1a.js"><link rel="prefetch" href="/webpack/assets/js/39.5c127e58.js"><link rel="prefetch" href="/webpack/assets/js/4.1b609518.js"><link rel="prefetch" href="/webpack/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/webpack/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/webpack/assets/js/7.a16cd5a1.js"><link rel="prefetch" href="/webpack/assets/js/8.341d4dda.js"><link rel="prefetch" href="/webpack/assets/js/9.e3c79c12.js">
    <link rel="stylesheet" href="/webpack/assets/css/0.styles.9c1b922f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webpack/" class="home-link router-link-active"><!----> <span class="site-name">Webpack</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webpack/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webpack/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/webpack/componentDocs/构建工具.html" class="sidebar-link">构建工具</a></li><li><a href="/webpack/componentDocs/webpack的配置.html" class="sidebar-link">配置</a></li><li><a href="/webpack/componentDocs/loader.html" class="sidebar-link">loader配置</a></li><li><a href="/webpack/componentDocs/mode.html" class="sidebar-link">development</a></li><li><a href="/webpack/componentDocs/plugin.html" class="sidebar-link">plugin配置</a></li><li><a href="/webpack/componentDocs/DevServer.html" class="sidebar-link">DevServer</a></li><li><a href="/webpack/componentDocs/Resolve.html" class="sidebar-link">Resolve配置</a></li><li><a href="/webpack/componentDocs/环境变量.html" class="sidebar-link">环境变量</a></li><li><a href="/webpack/componentDocs/其他配置.html" class="sidebar-link">其他配置</a></li><li><a href="/webpack/componentDocs/Scope Hoisting.html" class="sidebar-link">Scope Hoistring</a></li><li><a href="/webpack/componentDocs/Shimming.html" class="sidebar-link">Shimming 垫片</a></li><li><a href="/webpack/componentDocs/soucreMap.html" class="sidebar-link">soucre map</a></li><li><a href="/webpack/componentDocs/Tree Shaking.html" class="sidebar-link">Tree Shaking</a></li><li><a href="/webpack/componentDocs/Code Splitting2.html" class="sidebar-link">webpack代码分割</a></li><li><a href="/webpack/componentDocs/Code Splitting.html" class="sidebar-link">代码分割</a></li><li><a href="/webpack/componentDocs/Css 分割.html" class="sidebar-link">css 分割</a></li><li><a href="/webpack/componentDocs/Lazy Loading.html" class="sidebar-link">Lazying Loading</a></li><li><a href="/webpack/componentDocs/DllPlugin.html" class="sidebar-link">DllPlugin</a></li><li><a href="/webpack/componentDocs/postcss.html" class="sidebar-link">postcss</a></li><li><a href="/webpack/componentDocs/vue-loader.html" class="sidebar-link">vue-loader</a></li><li><a href="/webpack/componentDocs/提取公共代码.html" class="sidebar-link">提取公共代码</a></li><li><a href="/webpack/componentDocs/打包分析 + 代码利用率.html" class="sidebar-link">代码利用率</a></li><li><a href="/webpack/componentDocs/webpack 与 浏览器缓存.html" class="sidebar-link">利用缓存</a></li><li><a href="/webpack/componentDocs/代码检查.html" class="sidebar-link">eslint代码检查</a></li><li><a href="/webpack/componentDocs/多页面应用.html" class="sidebar-link">单页面应用</a></li><li><a href="/webpack/componentDocs/babel.html" aria-current="page" class="active sidebar-link">babel</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/webpack/componentDocs/PWA.html" class="sidebar-link">PWA</a></li><li><a href="/webpack/componentDocs/输出文件.html" class="sidebar-link">输出文件</a></li><li><a href="/webpack/componentDocs/打包原理.html" class="sidebar-link">打包原理</a></li><li><a href="/webpack/componentDocs/Webpack性能优化.html" class="sidebar-link">提升 Webpack 打包速度的方法</a></li><li><a href="/webpack/componentDocs/编写一个 loader.html" class="sidebar-link">编写一个 loader</a></li><li><a href="/webpack/componentDocs/编写一个 plugin.html" class="sidebar-link">编写一个 plugin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h1> <p>因为 ES6 的兼容性，导致在开发中不能够全面的使用 ES6 语法。</p> <p>我们可以将 ES6 编写的代码转换成目前已经支持良好的 ES5 代码。</p> <ol><li>把 ES6 语法用 ES5 实现，例如 ES6 的 class 语法用 ES5 prototype 实现。</li> <li>给新的 API 注入 polyfill, promise 这种挂在到全局对象上。</li></ol> <h3 id="babel-2"><a href="#babel-2" class="header-anchor">#</a> BaBel</h3> <p>Babel 可以完成上面的两种事情。 BaBel 是 js 的一个编译器，能够将 Es6 代码转为 ES5 代码，其实 Babel 只是在 源代码转换为抽象语法书 AST 的时候，把语法转换为 ES5 的抽象语法树,而不用担心兼容性问题, 通过插件机制根据需求灵活的扩展。在 Babel 执行编译的过程中，会从项目根目录下的 .babelrc 文件读取配置。.babelrc 是一个 JSON 格式的文件。</p> <h3 id="presets"><a href="#presets" class="header-anchor">#</a> Presets</h3> <p>presets 属性告诉 Babel 要转换的源码使用了哪些新的语法特性, 一个 Presets 对一组新语法特性提供支持. Presets 其实是一组 Plugins 的集合，每一个 Plugin 完成一个新语法的转换工作。Presets 是按照 ECMAScript 草案来组织的，通常可以分为以下三大类：</p> <ol><li><p>已经被写入 ECMAScript 标准里的特性，由于之前每年都有新特性被加入到标准里</p> <ul><li>es2015 包含在 2015 里加入的新特性。</li> <li>es2016 包含在 2016 里加入的新特性。</li> <li>es2017 包含在 2017 里加入的新特性。</li> <li>env 包含当前所有 ECMAScript 标准里的最新特性。</li></ul></li> <li><p>被社区提出来但还未被写入 ECMAScript 标准里的特性。</p> <ul><li>stage0 只是一个想法，有 Babel 插件实现了对这些特性的支持</li> <li>stage1 值得被纳入标准的特性；</li> <li>stage2 该特性规范已经被起草，将会被纳入标准里；</li> <li>stage3 该特性规范已经定稿，各大浏览器厂商和 Node.js 社区开始着手实现；</li> <li>stage4 在接下来的一年将会加入到标准里去。</li></ul></li></ol> <h3 id="plugins"><a href="#plugins" class="header-anchor">#</a> Plugins</h3> <p>plugins 属性告诉 Babel 要使用哪些插件，插件可以控制如何转换代码。</p> <h3 id="webpack-配置"><a href="#webpack-配置" class="header-anchor">#</a> webpack 配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>'@babel<span class="token operator">/</span>preset<span class="token operator">-</span>env<span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>babel-loader 不是用来 ES6 转译的, 它充其量只是一个打通 babel 与 webpack 的一个 桥梁 ，首先两者得建立一个连接。</p> <p>@babel/preset-env 是用来将 ES6 的语法转为 ES5的。比如 let、const 转为 var； ()=&gt;{} 转为 function () {} ES5函数。</p> <p>但是 @babel/preset-env 不会转换 新的API, 以及一些在全局对象上的方法 都不会进行转码。 比如 Iterator, Generator, Set, Maps, Proxy, Reflect,Symbol,Promise 等全局对象，以及 Object.assign ， Array.from 全局对象的方法，都不会进行转码。</p> <p>虽然也是进行了语法翻译，但是只是翻译了一部分 ES6 特性。在低版本依赖会报错。</p> <h3 id="polyfill-填充"><a href="#polyfill-填充" class="header-anchor">#</a> polyfill (填充)</h3> <p>我们可以借助 @babel/polyfill 来对这些 API 进行填充。</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save @babel<span class="token operator">/</span>polyfill

<span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span> 引入到我们使用了 <span class="token constant">ES6</span> 特性的文件。
</code></pre></div><p>这样子，我们就可以了看到，API 都被 polyfill 好打包输出到 bundle.js 文件。babel 会将所有的 polyfill 全部引入，这样会导致结果的包大小非常大，而我们可能仅仅需要一个方法而已.</p> <h3 id="按需加载"><a href="#按需加载" class="header-anchor">#</a> 按需加载</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>我们通过 useBuiltIns: 'usage' 配置，就可以做到 按需转译。</p> <ul><li><p>babel 的 polyfill 机制是，对于例如 Array.from 等静态方法，直接在 global.Array 上添加；对于例如 includes 等实例方法，直接在 global.Array.prototype 上添加。这样直接修改了全局变量的原型，有可能会带来意想不到的问题。污染全局.</p></li> <li><p>babel 经常会使用一些辅助函数来帮忙转。</p></li> <li><p>class 语法中，babel 自定义了 _classCallCheck 这个函数来辅助；typeof 则是直接重写了一遍，自定义了 _typeof 这个函数来辅助。这些函数叫做 helpers。如果一个项目中有100个文件，其中每个文件都写了一个 class，那么这个项目最终打包的产物里就会存在100个 _classCallCheck 函数，这样肯定是不好的。</p></li></ul> <h3 id="组件库-类库"><a href="#组件库-类库" class="header-anchor">#</a> 组件库，类库</h3> <p>为了不污染全局对象和内置的对象原型，又想要在低版本浏览器运行，可以配合使用babel-runtime 和 @babel/plugin-transform-runtime。</p> <p>比如当前运行环境不支持 promise，可以通过引入 babel-runtime/core-js/promise 来获取 promise。</p> <p>在一开始的时候，只是存在 babel-runtime，用起来不方便，但代码中引入 helper 函数，意味着不能页面间共享，造成打包完很多重复的 helper 代码。</p> <p>Babel又开发了 @babel/plugin-transform-runtime，这个模块会将我们的代码重写，然后引入 helper 函数。这样子就避免了重复打包代码和手动引入的繁琐。</p> <p>@babel/plugin-transform-runtime 的作用就是转译代码，转译后的代码中可能会引入 @babel/runtime-corejs2 里面的模块。@babel/runtime-corejs2 需要被打包到最终产物里在浏览器中运行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>指定 runtime-corejs 的版本，目前有 2 3 两个版本，默认值是 false，不会 polyfill 提案。</p> <p>使用了 @babel/plugin-transform-runtime 之后</p> <ol><li>API 从直接修改原型改为从一个统一的模块中引入，避免了对全局变量及其原型的污染。</li> <li>helpers 从之前的直接定义改为了从一个统一的模块中引入,使得打包的结果中每个 helper 只会存在一个。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webpack/componentDocs/多页面应用.html" class="prev">
        单页面应用
      </a></span> <span class="next"><a href="/webpack/componentDocs/PWA.html">
        PWA
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/webpack/assets/js/app.393cc6fe.js" defer></script><script src="/webpack/assets/js/2.aef1e260.js" defer></script><script src="/webpack/assets/js/20.e6f9b446.js" defer></script>
  </body>
</html>
